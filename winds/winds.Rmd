---
title: "TTT, flux et champs vectoriel pour la visualisation de matrice OD</br>"
author: "Etienne Côme"
date: "**2020**"
output:
  unilur::tutorial_html_solution:
    toc: true
    toc_float: false
    toc_depth: 1
    suffix: ""
    theme: journal
    highlight: kate
    number_sections: no
    number_subsections: no
---

```{r knitr_init, echo=FALSE, cache=FALSE, include=FALSE}
library(knitr)
library(sf)
library(dplyr)
library(ttt)
## Global options
options(max.print="90")
opts_chunk$set(echo=TRUE,
               cache=FALSE, #TRUE
               prompt=FALSE,
               tidy=FALSE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=90)
options(width = 90)

# no margins
knit_hooks$set(nm = function(before, options, envir){
  if (before){
    par(mar=c(0,0,0,0))
  }
})

# title margins
knit_hooks$set(sm = function(before, options, envir){
  if (before){
    par(mar=c(0,0,1.2,0))
  }
})

# boxes custom
#devtools::install_github("koncina/unilur")
knitr::opts_template$set(alert = list(box.title = "Watch out!",
                                      box.body = list(fill = "#ffe0d9", colour = "black"),
                                      box.header = list(fill = "#FFAD99", colour = "black"),
                                      box.collapse = NULL,
                                      box.icon = "fa-exclamation-triangle"))
knitr::opts_template$set(solution = list(box.title = "Solution",
                                         box.body = list(fill = "#e6f6e7", colour = "black"),
                                         box.header = list(fill = "#ace1af", colour = "black"),
                                         box.icon = "fa-check-square",
                                         box.collapse = TRUE))
knitr::opts_template$set(information = list(box.title = "Information",
                                            box.body = list(fill = "#bbe8f4", colour = "black"),
                                            box.header = list(fill = "#64c9e6", colour = "black"),
                                            box.icon = "fa-info-circle",
                                            box.collapse = NULL))
knitr::opts_template$set(clues = list(box.title = "Indices",
                                      box.body = list(fill = "#fff9dc", colour = "black"),
                                      box.header = list(fill = "#ffec8b", colour = "black"),
                                      box.icon = "fa-search",
                                      box.collapse = TRUE))
```


</br>


# Installation de ttt

```{r, echo=TRUE,eval=FALSE}
remotes::install_github("tributetotobler/ttt")
library(ttt)
library(sf)
library(dplyr)
```

# Exercise 1 : un exemple historique, les dollars de Tobler

```{block, box.title = "Lire des données", box.body = list(fill = "white"), box.icon = "fa-star"}
Importez les données dollars contenues dans le package `ttt` et regardez leurs structure. 
```


```{block, opts.label = "clues"}
Utilisez `data(dollars)` et `str(dollars)`
```

```{r, solution = TRUE}
data(dollars)
str(dollars)
```

Vous deviez avoir dans votre environement une liste `dollars` avec trois champs  :

- un champ `OD` contenant une matrice OD de taille 12 x 12 contenant des flux
- un champ `polygones` contenant les contours des 12 régions des USA 

```{block, box.title = "Observations et prétraitements", box.body = list(fill = "white"), box.icon = "fa-star"}
Importez les données dollars contenues dans le package `ttt` et regardez leurs structure. 
```




```{r, solution=TRUE}
delta = rowSums(dollars$OD)-colSums(dollars$OD)
dollars$polygones$delta=delta
```



```{r, echo=FALSE}
plot(st_geometry(dollars$polygones))
plusmoins(dollars$polygones,"delta")
```

```{r, solution=TRUE}
plot(st_geometry(dollars$polygones))
plusmoins(dollars$polygones,"delta")
```


```{r, solution=TRUE}
pot.dollars = poisson.potential(dollars$polygones,nb_it = 5000)
```

```{r, echo=FALSE}
plot(pot.dollars%>% select(attractivity))
```

```{r, solution=TRUE}
plot(pot.dollars%>% select(attractivity))
```


```{r, echo=FALSE}
plot(st_geometry(dollars$polygones))
poisson.flows(pot.dollars)
```

```{r, solution=TRUE}
plot(st_geometry(dollars$polygones))
poisson.flows(pot.dollars)
```





**reproducibility**

```{r}
sessionInfo()
```

